---
phase: 09-purchase-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(app)/profile/page.tsx
  - src/components/markets/BetSlip.tsx
autonomous: true
requirements: [PURC-05, PURC-06]

must_haves:
  truths:
    - "Profile page shows purchase history section with date, USD amount, and tokens received for each completed purchase"
    - "BetSlip shows a 'Buy more tokens' CTA linking to /buy when user has insufficient balance"
    - "Purchase history queries token_purchases table for the authenticated user"
  artifacts:
    - path: "src/app/(app)/profile/page.tsx"
      provides: "Profile page with purchase history section"
    - path: "src/components/markets/BetSlip.tsx"
      provides: "BetSlip with insufficient-balance buy CTA"
---

<objective>
Integrate token purchasing into the existing app experience: add purchase history to the profile page and a "Buy more tokens" CTA in the BetSlip when balance is insufficient. This is the final phase of v2.0.

Output: Purchase history visible on profile, BetSlip has contextual buy link, build passes.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Add purchase history to profile page</name>
  <files>
    src/app/(app)/profile/page.tsx
  </files>
  <action>
Add a "Purchase History" section to the profile page below the bet history:
- Query `token_purchases` table for the authenticated user, ordered by created_at desc
- Filter to `status = 'completed'` purchases only
- Display each purchase: date, tier label, dollar amount, tokens received
- Show "No purchases yet" with link to /buy if empty
  </action>
</task>

<task type="auto">
  <name>Task 2: Add insufficient-balance buy CTA to BetSlip</name>
  <files>
    src/components/markets/BetSlip.tsx
  </files>
  <action>
When the user's entered amount exceeds their balance, show a "Buy more tokens" link to /buy instead of (or in addition to) the disabled bet button.
  </action>
</task>

</tasks>
